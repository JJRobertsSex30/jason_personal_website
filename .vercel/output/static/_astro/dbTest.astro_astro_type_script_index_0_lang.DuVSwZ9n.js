import{_ as y}from"./preload-helper.BlTxHScW.js";function g(){const l=document.querySelectorAll(".manage-variants-btn");l.forEach(a=>{const e=a;e.addEventListener("click",()=>{const t=e.dataset.experimentId;if(!t)return;const n=document.getElementById(`manage-variants-section-${t}`),r=e.getAttribute("aria-expanded")==="true";if(n){n.classList.toggle("hidden"),e.setAttribute("aria-expanded",String(!r)),e.textContent=r?"Manage Variants":"Hide Variants";const i=new URL(window.location.href);r?i.searchParams.delete("openExperiment"):i.searchParams.set("openExperiment",t),window.history.pushState({path:i.href},"",i.href)}})}),window.addEventListener("popstate",()=>{const e=new URLSearchParams(window.location.search).get("openExperiment");if(document.querySelectorAll('[id^="manage-variants-section-"]').forEach(t=>{t.classList.add("hidden")}),l.forEach(t=>{const n=t;n.setAttribute("aria-expanded","false"),n.textContent="Manage Variants"}),e){const t=document.getElementById(`manage-variants-section-${e}`),n=document.querySelector(`.manage-variants-btn[data-experiment-id="${e}"]`);t&&t.classList.remove("hidden"),n&&(n.setAttribute("aria-expanded","true"),n.textContent="Hide Variants")}}),document.querySelectorAll(".edit-experiment-btn").forEach(a=>{const e=a;e.addEventListener("click",()=>{const t=e.dataset.experimentId;if(!t)return;const n=document.querySelector(`.experiment-display-section-${t}`),r=document.querySelector(`.experiment-actions-section-${t}`),i=document.querySelector(`.experiment-edit-form-section-${t}`);if(n&&n.classList.add("hidden"),r&&r.classList.add("hidden"),i){i.classList.remove("hidden");const d=i.querySelector('input[name="experiment_name"]');d&&d.focus()}})}),document.querySelectorAll(".cancel-edit-experiment-btn").forEach(a=>{const e=a;e.addEventListener("click",()=>{const t=e.dataset.experimentId;if(!t)return;const n=document.querySelector(`.experiment-display-section-${t}`),r=document.querySelector(`.experiment-actions-section-${t}`),i=document.querySelector(`.experiment-edit-form-section-${t}`);n&&n.classList.remove("hidden"),r&&r.classList.remove("hidden"),i&&i.classList.add("hidden")})}),document.querySelectorAll(".edit-variant-btn").forEach(a=>{const e=a;e.addEventListener("click",()=>{if(!e.dataset.variantId)return;const n=e.closest(".variant-item");if(!n)return;const r=n.querySelector(".variant-display-section"),i=n.querySelector(".variant-edit-form-section");r&&r.classList.add("hidden"),i&&i.classList.remove("hidden")})}),document.querySelectorAll(".cancel-edit-variant-btn").forEach(a=>{const e=a;e.addEventListener("click",()=>{if(!e.dataset.variantId)return;const n=e.closest(".variant-item");if(!n)return;const r=n.querySelector(".variant-display-section"),i=n.querySelector(".variant-edit-form-section");r&&r.classList.remove("hidden"),i&&i.classList.add("hidden")})}),document.querySelectorAll(".delete-variant-form").forEach(a=>{const e=a;e.addEventListener("submit",t=>{const n=e.dataset.variantName||"this variant";confirm(`Are you sure you want to delete "${n}"? This action cannot be undone, especially if the variant has no impressions.`)||t.preventDefault()})}),document.querySelectorAll(".delete-experiment-form").forEach(a=>{const e=a;e.addEventListener("submit",t=>{const n=e.dataset.experimentName||"this experiment";confirm(`Are you sure you want to delete the experiment "${n}" and all its associated variants and data? This action cannot be undone.`)||t.preventDefault()})});const m=document.querySelectorAll(".chart-container");m.length>0&&y(async()=>{const{default:a}=await import("./auto.IOqTu9vY.js");return{default:a}},[]).then(({default:a})=>{m.forEach(e=>{const t=e,n=t.dataset.experimentId;if(!n){console.error("Chart container missing experiment ID");return}const r=t.querySelector(`canvas#chart-${n}`);if(!r)return;let i=[];try{const s=t.dataset.variants;if(s)i=JSON.parse(s);else return}catch(s){console.error("Failed to parse variants data for chart:",s);return}const d=i.filter(s=>typeof s.rate=="number");if(d.length>0){const s=d.map(o=>`${o.name} (Imp: ${o.impressions??0}, Conv: ${o.conversions??0}, Rate: ${(o.rate??0).toFixed(1)}%)`),v=d.map(o=>o.rate??0),b=d.length,u=[{r:54,g:162,b:235},{r:255,g:99,b:132},{r:255,g:206,b:86},{r:75,g:192,b:192},{r:153,g:102,b:255},{r:255,g:159,b:64}],p=[],f=[];for(let o=0;o<b;o++){const c=u[o%u.length];p.push(`rgba(${c.r}, ${c.g}, ${c.b}, 0.6)`),f.push(`rgba(${c.r}, ${c.g}, ${c.b}, 1)`)}const h=a.getChart(r);h&&h.destroy(),new a(r,{type:"pie",data:{labels:s,datasets:[{label:"Conversion Rate (%)",data:v,backgroundColor:p,borderColor:f,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{boxWidth:20,font:{size:10}}},tooltip:{callbacks:{label:function(o){let c=o.label||"";return c&&(c+=": "),o.parsed!==null&&typeof o.parsed=="number"&&(c+=o.parsed.toFixed(2)+"%"),c}}}}}})}else{const s=a.getChart(r);s&&s.destroy()}})}).catch(a=>{console.error("Failed to load Chart.js dynamically:",a)})}document.addEventListener("astro:page-load",g);
